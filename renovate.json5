{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
    ':disableRateLimiting',
    ':rebaseStalePrs',
  ],
  'github-actions': {
    enabled: false,
  },
  bundler: {
    enabled: true,
  },
  terraform: {
    enabled: false,
  },
  baseBranchPatterns: [
    'develop',
  ],
  packageRules: [
    {
      matchCategories: [
        'ruby',
      ],
      rangeStrategy: 'bump',
    },
    {
      description: '@o-orand assignments',
      assignees: [
        'o-orand',
      ],
      matchPackageNames: [
        '*',
      ],
    },
    {
      addLabels: [
        '{{datasource}}',
        '{{depName}}',
      ],
      matchPackageNames: [
        '/.*/',
      ],
    },
    {
      matchDepNames: [
        'paas-docker-cloudfoundry-tools',
      ],
      branchTopic: '{{{depNameSanitized}}}-commit-id', // branch name will be: renovate/paas-docker-cloudfoundry-tools-commit-id
      // chore(deps): update paas-docker-cloudfoundry-tools commit-id to dbc8760 #420
      // default value for commitMessage: "{{{commitMessagePrefix}}} {{{commitMessageAction}}} {{{commitMessageTopic}}} {{{commitMessageExtra}}} {{{commitMessageSuffix}}}",

      commitMessageTopic: '{{{depNameSanitized}}} commit-id',
      prBodyNotes: [
        'paas-docker-cloudfoundry-tools repository: https://github.com/orange-cloudfoundry/paas-docker-cloudfoundry-tools',
        'Commits diff list: https://github.com/orange-cloudfoundry/paas-docker-cloudfoundry-tools/compare/{{{currentDigestShort}}}...{{{newDigestShort}}} ',
        'Diff: https://github.com/orange-cloudfoundry/paas-docker-cloudfoundry-tools/compare/{{{currentDigestShort}}}..{{{newDigestShort}}} ',
      ],
    },
    {
      matchDepNames: [
        'cloudfoundry/bosh-cli',
        'concourse/concourse',
      ],
      description: 'Group docker images cli bump unless it is a major version',
      matchUpdateTypes: [
        'patch',
        'minor',
      ],
      addLabels: [
        'COA CI',
      ],
    },
    {
      description: 'Bosh stemcell available on bosh.io',
      matchManagers: [
        'custom.regex',
      ],
      matchDepNames: [
        'cloudfoundry/bosh-linux-stemcell-builder',
      ],
      matchCurrentAge: '> 1 months',
      addLabels: [
        'type/bosh-stemcell',
        'jammy',
      ],
    },
    {
      description: 'Regroup tools used during Dev & Test',
      matchDepNames: [
        'docker_registry2',
        'github_changelog_generator',
        'rubocop-rspec',
        'git',
        'mdl',
        'rake',
        'reek',
        'rubocop',
        'cucumber',
        'rspec',
        'rspec-rerun',
        'simplecov',
      ],
      separateMajorMinor: true,
      addLabels: [
        'DevTest Tools',
      ],
      schedule: [
        'after 8am on the first day of the month',
      ],
    },
    {
      description: 'Regroup tools related to rubocop',
      matchDepNames: [
        'rubocop-rspec',
        'rubocop',
      ],
      groupName: 'Rubocop-Tools',
      addLabels: [
        'Rubocop Tools',
      ],
      schedule: [
        'after 8am on the first day of the month',
      ],
    },
  ],
  prHourlyLimit: 2, // Only create one PR per hour to avoid CI overflow
  customManagers: [
    {
      customType: 'regex',
      description: 'Bump COA CI cli dependencies',
      managerFilePatterns: [
        '/Dockerfile/',
      ],
      matchStrings: [
        // For dockerfile: https://regex101.com
        'datasource=(?<datasource>.+) depName=(?<depName>[\\w\\d\\//\\-\\_]+)( versioning=(?<versioning>.+))?\\nARG .+_VERSION=?\\"?(?<currentValue>[\\w\\d\\/\\-\\.\\_]+)\\"?',
      ],
      versioningTemplate: 'regex:(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)?$',
      extractVersionTemplate: '^v?(?<version>.*)$',
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        '/.*/.*\\.erb/',
        '/.*/.*\\.yml/',
        '/spec/lib/template_processor/.*_spec\\.rb/',
        '/spec/tasks/task_spec_helper.rb/',
        '/.*/task_spec.rb/',
      ],
      matchStrings: [
        // For spec files: https://regex101.com/r/ifWHDK/2
        '.+_VERSION\\s*=\\s*[\\"\\\']?(?<currentDigest>[\\w\\d\\/\\-\\.\\_]+)?[\\"\\\']?\\s* #\\s*renovate: datasource=(?<datasource>github-releases) depName=(?<depName>[\\w\\d\\//\\-\\_]+)( versioning=(?<versioning>.+))?\\s*',
        // template_repository/hello-world-root-depls/pipeline-sample/concourse-pipeline-config/docker-image-vars.yml
        'docker-image-tag:\\s*(\\\'|\\")?(?<currentDigest>.+)(\\\'|\\")?',
        // multi line *.yml
        'source:.*\\n.*\\s*repository: (((.*)))?elpaasoci\\/(cf-cli|curl-ssl|git-ssh|k8s-tools|terraform|bosh-cli-v2|spruce|spiff|awscli|bosh-cli-v2-cf-cli)\\n\\s*tag: (\\\'\\")?(?<currentDigest>.+)(\\\'\\")?',
        // single line yml: https://regex101.com/r/YfHHox/2
        'source:\\s*\\{\\s*repository: (((.*)))?elpaasoci\\/(cf-cli|curl-ssl|git-ssh|k8s-tools|terraform|bosh-cli-v2|spruce|spiff|awscli|bosh-cli-v2-cf-cli),\\s*tag: (\\\'\\")?(?<currentDigest>.+)(\\\'\\")?}',
        // task_spec_helper.rb - https://regex101.com/r/STu3OF/1
        "def .+_default_image_version\\n\\s*\\'(?<currentDigest>.+)\\'",
        // TF image bump
        "EXPECTED_TERRAFORM_IMAGE_TAG\\s*=\\s*'(?<currentDigest>.+)'(\\.freeze)?",
      ],
      currentValueTemplate: 'main-validated',
      depNameTemplate: 'paas-docker-cloudfoundry-tools',
      packageNameTemplate: 'https://github.com/orange-cloudfoundry/paas-docker-cloudfoundry-tools',
      datasourceTemplate: 'git-refs',
      versioningTemplate: 'git',
    },
    {
      customType: 'regex',
      description: 'bump of stemcell version within root-deployment.yaml: bosh stemcell hosted in bosh.io from github release tags. Not using github tags as they also include transient release candidates. matchStrings: https://regex101.com/r/wokPwY/1 extracts: for bionic currentValue=1.174  expecting tag=ubuntu-bionic/v1.195 and extractVersionTemplate: https://regex101.com/r/ZrrDJ2/1 See regex doc at https://docs.renovatebot.com/modules/manager/regex/',
      managerFilePatterns: [
        '/docs/reference_dataset/template_repository/hello-world-root-depls/root-deployment\\.yml$/',
      ],
      matchStrings: [
        'stemcell:\\n.*version: [\'|"](?<currentValue>[1-9.]+)[\'|"]',
      ],
      depNameTemplate: 'cloudfoundry/bosh-linux-stemcell-builder',
      datasourceTemplate: 'github-releases',
      versioningTemplate: 'regex:(?<major>\\d+)\\.(?<minor>\\d+)$',
      extractVersionTemplate: 'ubuntu-jammy/v(?<version>.*)$',
    },
    //    {
    //      //description: "manage all docker images used by concourse. It will detect elpassoci images but shoud not be able to detect any version published",
    //      description: "manage ruby docker images used by concourse",
    //      fileMatch: [
    //        ".*/.*\\.erb",
    //        ".*/.*\\.y(a)?ml",
    //        "spec/lib/template_processor/.*_spec\\.rb",
    //        "spec/tasks/task_spec_helper.rb",
    //        ".*/task_spec.rb"
    //      ],
    //      matchStrings: [
    //        // For concourse based files (resources and tasks): https://regex101.com/r/6ia3o9/1
    //        // "\\{?\\s*repository: (?<depName>[\\d\\.\\w\\-\\_\\/]+)(\\n|,|\\n.*\\n)?\\s*tag: (\\'\\\")?(?<currentValue>[\\d\\.\\w\\-\\_]+)(\\'\\\")?(})?"
    //        "\\{?\\s*repository: library/ruby(\\n|,|\\n.*\\n)?\\s*tag: (\\'\\\")?(?<currentValue>[\\d\\.\\w\\-\\_]+)(\\'\\\")?(})?"
    //
    //      ],
    //      datasourceTemplate: "docker",
    //      depNameTemplate: "ruby"
    //    }
  ],
}
